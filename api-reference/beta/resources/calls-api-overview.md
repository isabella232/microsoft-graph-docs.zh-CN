---
title: 使用 Microsoft Graph 中的呼叫和在线会议 API
description: Microsoft Graph 呼叫和在线会议 API 通过启用语音和视频功能，为应用程序和服务与用户的互动方式添加了新的维度。 该 API 可让你创建呼叫并接收来自 Microsoft Teams 中的用户和应用程序的呼叫。 你可以使用这些 API 构建可在呼叫或会议中充当参与者的服务应用程序（机器人）。
author: VinodRavichandran
localization_priority: Priority
ms.prod: microsoft-teams
ms.openlocfilehash: a84900147679901ad45a19180c05f17246768479
ms.sourcegitcommit: 014eb3944306948edbb6560dbe689816a168c4f7
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/26/2019
ms.locfileid: "33328307"
---
# <a name="working-with-the-calls-and-online-meetings-api-in-microsoft-graph"></a><span data-ttu-id="bab2b-105">使用 Microsoft Graph 中的呼叫和在线会议 API</span><span class="sxs-lookup"><span data-stu-id="bab2b-105">Working with the calls and online meetings API in Microsoft Graph</span></span>

[!INCLUDE [beta-disclaimer](../../includes/beta-disclaimer.md)]

<span data-ttu-id="bab2b-106">Microsoft Graph 呼叫和在线会议 API 通过启用语音和视频功能，为应用程序和服务与用户的互动方式添加了新的维度。</span><span class="sxs-lookup"><span data-stu-id="bab2b-106">The Microsoft Graph calls and online meetings API adds a new dimension to how your apps and services can interact with users by enabling voice and video features.</span></span> <span data-ttu-id="bab2b-107">该 API 可让你创建呼叫并接收来自 Microsoft Teams 中的用户和应用程序的呼叫。</span><span class="sxs-lookup"><span data-stu-id="bab2b-107">The API enables you to create calls and receive calls from users and applications in Microsoft Teams.</span></span> <span data-ttu-id="bab2b-108">你可以使用这些 API 构建可在呼叫或会议中充当参与者的服务应用程序（机器人）。</span><span class="sxs-lookup"><span data-stu-id="bab2b-108">You can use these APIs to build a service application (bot) that can act as a participant in a call or meeting.</span></span>

## <a name="call-types"></a><span data-ttu-id="bab2b-109">呼叫类型</span><span class="sxs-lookup"><span data-stu-id="bab2b-109">Call types</span></span>

<span data-ttu-id="bab2b-110">呼叫分为对等呼叫和多方呼叫。</span><span class="sxs-lookup"><span data-stu-id="bab2b-110">Calls are categorized as peer-to-peer or multiparty calls.</span></span> <span data-ttu-id="bab2b-111">用户可以向机器人发起对等呼叫，也可以邀请机器人加入现有的多方会议。</span><span class="sxs-lookup"><span data-stu-id="bab2b-111">A user can initiate a peer-to-peer call with your bot or invite your bot into an existing multiparty conference.</span></span> <span data-ttu-id="bab2b-112">当用户邀请机器人进行对等呼叫时，无需任何权限。</span><span class="sxs-lookup"><span data-stu-id="bab2b-112">No permissions are necessary when the user is inviting the bot to a peer-to-peer call.</span></span> <span data-ttu-id="bab2b-113">若要让机器人参与多方呼叫，机器人需要获得租户管理员的许可才能加入群组通话。</span><span class="sxs-lookup"><span data-stu-id="bab2b-113">For your bot to participate in a multiparty call, the bot needs to have permission from the tenant administrator to join a group call.</span></span>

![显示对等呼叫和多方呼叫的图像](https://cdn.graph.office.net/prod/GraphDocuments/en-us/concepts/images/call-types.png)

<span data-ttu-id="bab2b-115">如果要让机器人创建呼叫，它需要具有发起呼叫或发起群组通话的权限。</span><span class="sxs-lookup"><span data-stu-id="bab2b-115">If your bot is creating the call, it needs to have either the initiate or the initiate-group-call permission.</span></span> <span data-ttu-id="bab2b-116">机器人可以选择创建对等呼叫或多方呼叫。</span><span class="sxs-lookup"><span data-stu-id="bab2b-116">Your bot has the option to create a peer-to-peer call or a multiparty call.</span></span>

- <span data-ttu-id="bab2b-117">对于对等呼叫，机器人只需要指定一个目标，而无需指定会议坐标。</span><span class="sxs-lookup"><span data-stu-id="bab2b-117">For a peer-to-peer call, the bot needs to specify only one target and no meeting coordinates.</span></span> 
- <span data-ttu-id="bab2b-118">如果机器人向多名参与者发起呼叫，则会在幕后设置临时会议，并且每个人都可加入该会议。</span><span class="sxs-lookup"><span data-stu-id="bab2b-118">If your bot initiates a call with multiple participants, an ad hoc meeting is set up behind the scenes and everyone joins that conference.</span></span> <span data-ttu-id="bab2b-119">如果指定了会议坐标，则即使只有一个目标，也会设置多方呼叫。</span><span class="sxs-lookup"><span data-stu-id="bab2b-119">If meeting coordinates are specified, a multiparty call is set up even if there is only one target.</span></span>

<span data-ttu-id="bab2b-120">呼叫可能会以对等的方式开始，并升级为多方。</span><span class="sxs-lookup"><span data-stu-id="bab2b-120">A call might start as peer-to-peer and escalate to multiparty.</span></span> <span data-ttu-id="bab2b-121">系统将自动设置会议，并且媒体将重定向到会议。</span><span class="sxs-lookup"><span data-stu-id="bab2b-121">A conference is provisioned automatically and the media is retargeted to the conference.</span></span> <span data-ttu-id="bab2b-122">如果机器人具有发起群组通话的权限，则它可以通过邀请其他人来发起升级。</span><span class="sxs-lookup"><span data-stu-id="bab2b-122">Your bot can initiate escalation by inviting others, provided your bot has the initiate-group-call permission.</span></span> <span data-ttu-id="bab2b-123">如果升级是由另一名参与者发起的并且机器人没有加入群组通话的权限，那么将从通话中删除该机器人。</span><span class="sxs-lookup"><span data-stu-id="bab2b-123">If escalation is initiated by another participant and the bot does not have join-group-call permission, your bot is dropped from the call.</span></span>

> <span data-ttu-id="bab2b-124">**重要说明：** 如果将呼叫从对等升级为多方，则并非所有多方呼叫功能都可用。</span><span class="sxs-lookup"><span data-stu-id="bab2b-124">**Important:** When a call is escalated from peer-to-peer to multiparty, not all multiparty features are available.</span></span> <span data-ttu-id="bab2b-125">具体而言，机器人无法接收名单更新。</span><span class="sxs-lookup"><span data-stu-id="bab2b-125">Specifically, the bot will not receive roster updates.</span></span>

## <a name="signaling"></a><span data-ttu-id="bab2b-126">信号</span><span class="sxs-lookup"><span data-stu-id="bab2b-126">Signaling</span></span>

### <a name="incoming-call"></a><span data-ttu-id="bab2b-127">传入呼叫</span><span class="sxs-lookup"><span data-stu-id="bab2b-127">Incoming call</span></span>

<span data-ttu-id="bab2b-128">若要接收传入呼叫，你需要注册呼叫机器人。</span><span class="sxs-lookup"><span data-stu-id="bab2b-128">To receive an incoming call, you need to register the calling bot.</span></span> <span data-ttu-id="bab2b-129">当机器人接收传入通知时，它包含以下选项。</span><span class="sxs-lookup"><span data-stu-id="bab2b-129">When the bot receives the incoming notification, it has the following options.</span></span>

| <span data-ttu-id="bab2b-130">方法</span><span class="sxs-lookup"><span data-stu-id="bab2b-130">Method</span></span>                              | <span data-ttu-id="bab2b-131">说明</span><span class="sxs-lookup"><span data-stu-id="bab2b-131">Description</span></span>                                  |
|:------------------------------------|:---------------------------------------------|
| [<span data-ttu-id="bab2b-132">应答</span><span class="sxs-lookup"><span data-stu-id="bab2b-132">Answer</span></span>](../api/call-answer.md)     | <span data-ttu-id="bab2b-133">应答传入呼叫。</span><span class="sxs-lookup"><span data-stu-id="bab2b-133">Answer the incoming call.</span></span>                    |
| [<span data-ttu-id="bab2b-134">拒绝</span><span class="sxs-lookup"><span data-stu-id="bab2b-134">Reject</span></span>](../api/call-reject.md)     | <span data-ttu-id="bab2b-135">拒绝并挂断呼叫。</span><span class="sxs-lookup"><span data-stu-id="bab2b-135">Reject and hangup the call.</span></span>                  |
| [<span data-ttu-id="bab2b-136">重定向</span><span class="sxs-lookup"><span data-stu-id="bab2b-136">Redirect</span></span>](../api/call-redirect.md) | <span data-ttu-id="bab2b-137">重定向呼叫。</span><span class="sxs-lookup"><span data-stu-id="bab2b-137">Redirect the call.</span></span>                           |

<span data-ttu-id="bab2b-138">机器人可以将呼叫重定向到其他用户或机器人。</span><span class="sxs-lookup"><span data-stu-id="bab2b-138">The bot can redirect the call to another user or a bot.</span></span> <span data-ttu-id="bab2b-139">机器人还可以将它重定向到用户的语音邮件。</span><span class="sxs-lookup"><span data-stu-id="bab2b-139">The bot can also redirect it to a user's voicemail.</span></span>

![显示机器人将呼叫重定向到语音邮件的图像](https://cdn.graph.office.net/prod/GraphDocuments/en-us/concepts/images/call-handling.png)

> <span data-ttu-id="bab2b-141">**重要说明：** 目前不支持向 PSTN 进行重定向或出站呼叫。</span><span class="sxs-lookup"><span data-stu-id="bab2b-141">**Important:** Redirecting or making outbound calls to PSTN is currently not supported.</span></span>

### <a name="in-call"></a><span data-ttu-id="bab2b-142">通话中</span><span class="sxs-lookup"><span data-stu-id="bab2b-142">In-call</span></span>

<span data-ttu-id="bab2b-143">机器人操作在呼叫对象上可用。</span><span class="sxs-lookup"><span data-stu-id="bab2b-143">Operations for the bot are available on the call object.</span></span> <span data-ttu-id="bab2b-144">这会影响机器人作为参与者加入呼叫。</span><span class="sxs-lookup"><span data-stu-id="bab2b-144">These affect the bot as the participant in the call.</span></span>

| <span data-ttu-id="bab2b-145">方法</span><span class="sxs-lookup"><span data-stu-id="bab2b-145">Method</span></span>                                                            | <span data-ttu-id="bab2b-146">说明</span><span class="sxs-lookup"><span data-stu-id="bab2b-146">Description</span></span>                                  |
|:------------------------------------------------------------------|:---------------------------------------------|
| [<span data-ttu-id="bab2b-147">静音</span><span class="sxs-lookup"><span data-stu-id="bab2b-147">Mute</span></span>](../api/call-mute.md)                                       | <span data-ttu-id="bab2b-148">在呼叫中将自己设为静音。</span><span class="sxs-lookup"><span data-stu-id="bab2b-148">Mute self in the call.</span></span>                       |
| [<span data-ttu-id="bab2b-149">取消静音</span><span class="sxs-lookup"><span data-stu-id="bab2b-149">Unmute</span></span>](../api/call-unmute.md)                                   | <span data-ttu-id="bab2b-150">在呼叫中将自己取消静音。</span><span class="sxs-lookup"><span data-stu-id="bab2b-150">Unmute self in the call.</span></span>                     |
| [<span data-ttu-id="bab2b-151">UpdateMetadata</span><span class="sxs-lookup"><span data-stu-id="bab2b-151">UpdateMetadata</span></span>](../api/call-updatemetadata.md)                   | <span data-ttu-id="bab2b-152">在名单中更新自己的元数据。</span><span class="sxs-lookup"><span data-stu-id="bab2b-152">Update metadata for self in roster.</span></span>          |
| [<span data-ttu-id="bab2b-153">ChangeScreenSharingRole</span><span class="sxs-lookup"><span data-stu-id="bab2b-153">ChangeScreenSharingRole</span></span>](../api/call-changescreensharingrole.md) | <span data-ttu-id="bab2b-154">在呼叫中开始和停止共享屏幕。</span><span class="sxs-lookup"><span data-stu-id="bab2b-154">Start and stop sharing screen in the call.</span></span>   |

<span data-ttu-id="bab2b-155">若要与呼叫中的其他参与者进行互动，请使用参与者对象。</span><span class="sxs-lookup"><span data-stu-id="bab2b-155">To interact with other participants on the call, use the participants object.</span></span>

| <span data-ttu-id="bab2b-156">方法</span><span class="sxs-lookup"><span data-stu-id="bab2b-156">Method</span></span>                                                            | <span data-ttu-id="bab2b-157">说明</span><span class="sxs-lookup"><span data-stu-id="bab2b-157">Description</span></span>                                  |
|:------------------------------------------------------------------|:---------------------------------------------|
| [<span data-ttu-id="bab2b-158">列出参与者</span><span class="sxs-lookup"><span data-stu-id="bab2b-158">List participants</span></span>](../api/call-list-participants.md)             | <span data-ttu-id="bab2b-159">获取参与者对象集合。</span><span class="sxs-lookup"><span data-stu-id="bab2b-159">Get a participant object collection.</span></span>         |
| [<span data-ttu-id="bab2b-160">邀请参与者</span><span class="sxs-lookup"><span data-stu-id="bab2b-160">Invite Participants</span></span>](../api/participant-invite.md)               | <span data-ttu-id="bab2b-161">邀请参与者加入活动呼叫。</span><span class="sxs-lookup"><span data-stu-id="bab2b-161">Invite participants to the active call.</span></span>      |
| [<span data-ttu-id="bab2b-162">将所有参与者设为静音</span><span class="sxs-lookup"><span data-stu-id="bab2b-162">Mute All Participants</span></span>](../api/participant-muteall.md)            | <span data-ttu-id="bab2b-163">将呼叫中的所有参与者设为静音。</span><span class="sxs-lookup"><span data-stu-id="bab2b-163">Mute all participants in the call.</span></span>           |

## <a name="media"></a><span data-ttu-id="bab2b-164">媒体</span><span class="sxs-lookup"><span data-stu-id="bab2b-164">Media</span></span>

<span data-ttu-id="bab2b-165">通过 Microsoft 实时媒体平台来管理媒体处理。</span><span class="sxs-lookup"><span data-stu-id="bab2b-165">Media processing is managed through the Microsoft Real-time Media Platform.</span></span> <span data-ttu-id="bab2b-166">实时媒体平台可帮助机器人参与 Microsoft Teams 音频/视频通话和会议。</span><span class="sxs-lookup"><span data-stu-id="bab2b-166">The Real-time Media Platform helps bots engage in Microsoft Teams audio/video calls and meetings.</span></span> <span data-ttu-id="bab2b-167">它允许实时机器人参与对等呼叫和多方呼叫。</span><span class="sxs-lookup"><span data-stu-id="bab2b-167">It allows real-time bots to participate in both peer-to-peer and multiparty calls.</span></span>

<span data-ttu-id="bab2b-168">当机器人接听来电或加入新呼叫或现有呼叫时，需要告诉实时媒体平台如何处理媒体。</span><span class="sxs-lookup"><span data-stu-id="bab2b-168">When the bot answers an incoming call, or joins a new or existing call, it needs to tell the Real-time Media Platform how media will be handled.</span></span> <span data-ttu-id="bab2b-169">如果要构建互动语音响应 (IVR) 系统，则可以将昂贵的音频处理卸载到 Microsoft 服务托管的媒体组件。</span><span class="sxs-lookup"><span data-stu-id="bab2b-169">If you are building an Interactive Voice Response (IVR) system, you can offload the expensive audio processing to Microsoft service hosted media components.</span></span> <span data-ttu-id="bab2b-170">如果机器人需要直接访问媒体流，我们会通过实时媒体 SDK 提供应用程序托管的媒体选项。</span><span class="sxs-lookup"><span data-stu-id="bab2b-170">If your bot requires direct access to media streams, we offer an application-hosted media option through the Real-time Media SDK.</span></span>

### <a name="service-hosted-media"></a><span data-ttu-id="bab2b-171">服务托管的媒体</span><span class="sxs-lookup"><span data-stu-id="bab2b-171">Service-hosted media</span></span>

<span data-ttu-id="bab2b-172">机器人可以管理工作流并将音频处理卸载到 Microsoft 实时媒体平台。</span><span class="sxs-lookup"><span data-stu-id="bab2b-172">Bots can manage the workflow and offload audio processing to the Microsoft Real-time Media Platform.</span></span> <span data-ttu-id="bab2b-173">对于服务托管的媒体，你可以通过多个选项来实施和托管机器人。</span><span class="sxs-lookup"><span data-stu-id="bab2b-173">With service-hosted media, you have serveral options to implement and host your bot.</span></span> <span data-ttu-id="bab2b-174">请考虑使用其中一个可用的 [SDK](https://developer.microsoft.com/graph/code-samples-and-sdks)。</span><span class="sxs-lookup"><span data-stu-id="bab2b-174">Consider using one of the available [SDKs](https://developer.microsoft.com/graph/code-samples-and-sdks).</span></span> <span data-ttu-id="bab2b-175">服务托管的媒体机器人可以作为无状态服务进行实施，因为它不在本地处理媒体。</span><span class="sxs-lookup"><span data-stu-id="bab2b-175">A service-hosted media bot can be implemented as a stateless service as it does not process media locally.</span></span>

| <span data-ttu-id="bab2b-176">方法</span><span class="sxs-lookup"><span data-stu-id="bab2b-176">Method</span></span>                                                        | <span data-ttu-id="bab2b-177">说明</span><span class="sxs-lookup"><span data-stu-id="bab2b-177">Description</span></span>                                             |
|:--------------------------------------------------------------|:--------------------------------------------------------|
| [<span data-ttu-id="bab2b-178">PlayPrompt</span><span class="sxs-lookup"><span data-stu-id="bab2b-178">PlayPrompt</span></span>](../api/call-playprompt.md)                       | <span data-ttu-id="bab2b-179">向用户播放音频剪辑。</span><span class="sxs-lookup"><span data-stu-id="bab2b-179">Play an audio clip to the user.</span></span>                         |
| [<span data-ttu-id="bab2b-180">录制</span><span class="sxs-lookup"><span data-stu-id="bab2b-180">Record</span></span>](../api/call-record.md)                               | <span data-ttu-id="bab2b-181">（可选）播放提示并录制音频剪辑。</span><span class="sxs-lookup"><span data-stu-id="bab2b-181">Optionally play a prompt and record an audio clip.</span></span>      |
| [<span data-ttu-id="bab2b-182">SubscribeToTone</span><span class="sxs-lookup"><span data-stu-id="bab2b-182">SubscribeToTone</span></span>](../api/call-subscribetotone.md)             | <span data-ttu-id="bab2b-183">订阅用户的 DTMF 音。</span><span class="sxs-lookup"><span data-stu-id="bab2b-183">Subscribe to DTMF tones from the user.</span></span>                  |
| [<span data-ttu-id="bab2b-184">CancelMediaProcessing</span><span class="sxs-lookup"><span data-stu-id="bab2b-184">CancelMediaProcessing</span></span>](../api/call-cancelmediaprocessing.md) | <span data-ttu-id="bab2b-185">取消已排队的所有媒体处理。</span><span class="sxs-lookup"><span data-stu-id="bab2b-185">Cancel any media processing already queued.</span></span>             |

### <a name="application-hosted-media"></a><span data-ttu-id="bab2b-186">应用程序托管的媒体</span><span class="sxs-lookup"><span data-stu-id="bab2b-186">Application-hosted media</span></span>

<span data-ttu-id="bab2b-187">若要让机器人直接访问媒体，该机器人需要具有访问媒体的权限。</span><span class="sxs-lookup"><span data-stu-id="bab2b-187">For the bot to get direct access to the media, the bot needs the Access-Media permission.</span></span> <span data-ttu-id="bab2b-188">实时媒体库和有状态 SDK 可帮助你构建各种实时媒体呼叫机器人。</span><span class="sxs-lookup"><span data-stu-id="bab2b-188">The Real-time Media library and the stateful SDK helps you build rich real-time media calling bots.</span></span> <span data-ttu-id="bab2b-189">必须在 Windows 环境中托管应用程序托管的机器人。</span><span class="sxs-lookup"><span data-stu-id="bab2b-189">An application-hosted bot must be hosted in a Windows environment.</span></span> <span data-ttu-id="bab2b-190">[应用程序托管的媒体示例](https://github.com/microsoftgraph/microsoft-graph-comms-samples)显示了如何在各种 Azure 平台（包括云服务和 Service Fabric）中构建机器人。</span><span class="sxs-lookup"><span data-stu-id="bab2b-190">[Application hosted media samples](https://github.com/microsoftgraph/microsoft-graph-comms-samples) show how to build the bot in various Azure Platforms (including Cloud Services and Service Fabric).</span></span>

<span data-ttu-id="bab2b-191">你可以使用 [Microsoft Graph 呼叫 SDK](https://microsoftgraph.github.io/microsoft-graph-comms-samples/docs/articles/index.html) 简化机器人的创建过程。</span><span class="sxs-lookup"><span data-stu-id="bab2b-191">You can use the [Microsoft Graph Calls SDK](https://microsoftgraph.github.io/microsoft-graph-comms-samples/docs/articles/index.html) to simplify the creation of bots.</span></span> <span data-ttu-id="bab2b-192">该 SDK 提供了用于管理内存中的资源状态和引入机器人开发人员媒体堆栈的功能。</span><span class="sxs-lookup"><span data-stu-id="bab2b-192">The SDK provides functionality to manage the states of the resources in memory and to pull in bot developers' media stack.</span></span>

<span data-ttu-id="bab2b-193">媒体 SDK 允许机器人发送和接收音频、视频以及基于视频的屏幕共享内容。</span><span class="sxs-lookup"><span data-stu-id="bab2b-193">The Media SDK allows the bot to send and receive audio, video, and video-based screen sharing content.</span></span> <span data-ttu-id="bab2b-194">基于视频的屏幕共享将作为视频频道进行建模。</span><span class="sxs-lookup"><span data-stu-id="bab2b-194">Video-based screen sharing is modeled as a video channel.</span></span> <span data-ttu-id="bab2b-195">机器人可以订阅混合音频频道和多个视频频道。</span><span class="sxs-lookup"><span data-stu-id="bab2b-195">The bot can subscribe to the mixed audio channel and multiple video channels.</span></span> <span data-ttu-id="bab2b-196">对于视频频道，机器人可以选择以编码的 H.264 流或解码的原始帧发送和接收视频。</span><span class="sxs-lookup"><span data-stu-id="bab2b-196">For the video channel, the bot has a choice to send and receive video as an encoded H.264 stream or as decoded raw frames.</span></span>

> <span data-ttu-id="bab2b-197">**注释：** 请勿使用 Microsoft.Graph.Calls.Media API 来记录或以其他方式保留机器人访问的通话或会议中的媒体内容。</span><span class="sxs-lookup"><span data-stu-id="bab2b-197">**Note:** You may not use the Microsoft.Graph.Calls.Media API to record or otherwise persist media content from calls or meetings that your bot accesses.</span></span>

## <a name="see-also"></a><span data-ttu-id="bab2b-198">另请参阅</span><span class="sxs-lookup"><span data-stu-id="bab2b-198">See also</span></span>

[<span data-ttu-id="bab2b-199">呼叫和在线会议 API 示例</span><span class="sxs-lookup"><span data-stu-id="bab2b-199">Calls and online meetings API samples</span></span>](https://github.com/microsoftgraph/microsoft-graph-comms-samples/)

[<span data-ttu-id="bab2b-200">已知问题</span><span class="sxs-lookup"><span data-stu-id="bab2b-200">Known issues</span></span>](/graph/known-issues#calls-and-online-meetings)
