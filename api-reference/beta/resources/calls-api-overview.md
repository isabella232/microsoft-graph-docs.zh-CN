---
title: 使用呼叫和 Microsoft Graph 中的联机会议 API
description: Microsoft Graph 呼叫和联机会议 API 将新的维度添加到您的应用程序和服务的交互方式与用户通过启用语音和视频功能。 API，您可以创建呼叫和接收来自用户和应用程序中的 Microsoft 团队的呼叫。 这些 Api 可用于构建可以充当呼叫或会议中的参与者的服务应用程序 （自动程序）。
author: VinodRavichandran
localization_priority: Priority
ms.openlocfilehash: d7912f587dcc0181a2edd4072f0e07aa643d66be
ms.sourcegitcommit: d2b3ca32602ffa76cc7925d7f4d1e2258e611ea5
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/11/2019
ms.locfileid: "27876529"
---
# <a name="working-with-the-calls-and-online-meetings-api-in-microsoft-graph"></a><span data-ttu-id="74aaa-105">使用呼叫和 Microsoft Graph 中的联机会议 API</span><span class="sxs-lookup"><span data-stu-id="74aaa-105">Working with the calls and online meetings API in Microsoft Graph</span></span>

> <span data-ttu-id="74aaa-106">**重要说明：** Microsoft Graph 中 /beta 版本下的 API 是预览版，可能会发生变化。</span><span class="sxs-lookup"><span data-stu-id="74aaa-106">**Important:** APIs under the /beta version in Microsoft Graph are in preview and are subject to change.</span></span> <span data-ttu-id="74aaa-107">不支持在生产应用程序中使用这些 API。</span><span class="sxs-lookup"><span data-stu-id="74aaa-107">Use of these APIs in production applications is not supported.</span></span>

<span data-ttu-id="74aaa-108">Microsoft Graph 呼叫和联机会议 API 将新的维度添加到您的应用程序和服务的交互方式与用户通过启用语音和视频功能。</span><span class="sxs-lookup"><span data-stu-id="74aaa-108">The Microsoft Graph calls and online meetings API adds a new dimension to how your apps and services can interact with users by enabling voice and video features.</span></span> <span data-ttu-id="74aaa-109">API，您可以创建呼叫和接收来自用户和应用程序中的 Microsoft 团队的呼叫。</span><span class="sxs-lookup"><span data-stu-id="74aaa-109">The API enables you to create calls and receive calls from users and applications in Microsoft Teams.</span></span> <span data-ttu-id="74aaa-110">这些 Api 可用于构建可以充当呼叫或会议中的参与者的服务应用程序 （自动程序）。</span><span class="sxs-lookup"><span data-stu-id="74aaa-110">You can use these APIs to build a service application (bot) that can act as a participant in a call or meeting.</span></span>

## <a name="call-types"></a><span data-ttu-id="74aaa-111">呼叫类型</span><span class="sxs-lookup"><span data-stu-id="74aaa-111">Call types</span></span>

<span data-ttu-id="74aaa-112">呼叫被分类为对等或多方呼叫。</span><span class="sxs-lookup"><span data-stu-id="74aaa-112">Calls are categorized as peer-to-peer or multiparty calls.</span></span> <span data-ttu-id="74aaa-113">用户可以启动与您自动程序的对等呼叫或邀请您自动程序到现有多方会议。</span><span class="sxs-lookup"><span data-stu-id="74aaa-113">A user can initiate a peer-to-peer call with your bot or invite your bot into an existing multiparty conference.</span></span> <span data-ttu-id="74aaa-114">用户正在邀请到对等呼叫自动程序时，不不需要任何权限。</span><span class="sxs-lookup"><span data-stu-id="74aaa-114">No permissions are necessary when the user is inviting the bot to a peer-to-peer call.</span></span> <span data-ttu-id="74aaa-115">参与多方呼叫您 bot、 bot 需要具有加入的组呼叫由租户管理员权限。</span><span class="sxs-lookup"><span data-stu-id="74aaa-115">For your bot to participate in a multiparty call, the bot needs to have permission from the tenant administrator to join a group call.</span></span>

![显示对等和多方呼叫图像](https://cdn.graph.office.net/prod/GraphDocuments/en-us/concepts/images/call-types.png)

<span data-ttu-id="74aaa-117">如果您自动程序创建呼叫，它需要用启动或启动组呼叫权限。</span><span class="sxs-lookup"><span data-stu-id="74aaa-117">If your bot is creating the call, it needs to have either the initiate or the initiate-group-call permission.</span></span> <span data-ttu-id="74aaa-118">您自动程序已创建的对等呼叫或多方呼叫的选项。</span><span class="sxs-lookup"><span data-stu-id="74aaa-118">Your bot has the option to create a peer-to-peer call or a multiparty call.</span></span>

- <span data-ttu-id="74aaa-119">对等呼叫，需要指定唯一的目标和没有会议坐标 bot。</span><span class="sxs-lookup"><span data-stu-id="74aaa-119">For a peer-to-peer call, the bot needs to specify only one target and no meeting coordinates.</span></span> 
- <span data-ttu-id="74aaa-120">如果您 bot 发起呼叫与多个参与者，在后台设置为临时会议和所有人加入会议。</span><span class="sxs-lookup"><span data-stu-id="74aaa-120">If your bot initiates a call with multiple participants, an ad hoc meeting is set up behind the scenes and everyone joins that conference.</span></span> <span data-ttu-id="74aaa-121">如果指定会议坐标，那么即使只有一个目标多方呼叫是可以设置。</span><span class="sxs-lookup"><span data-stu-id="74aaa-121">If meeting coordinates are specified, a multiparty call is set up even if there is only one target.</span></span>

<span data-ttu-id="74aaa-122">可能对等以启动并升级到多方呼叫。</span><span class="sxs-lookup"><span data-stu-id="74aaa-122">A call might start as peer-to-peer and escalate to multiparty.</span></span> <span data-ttu-id="74aaa-123">会议已自动设置和媒体重定向到会议。</span><span class="sxs-lookup"><span data-stu-id="74aaa-123">A conference is provisioned automatically and the media is retargeted to the conference.</span></span> <span data-ttu-id="74aaa-124">提供您自动程序已启动组呼叫权限，您自动程序可以通过邀请其他人，启动升级。</span><span class="sxs-lookup"><span data-stu-id="74aaa-124">Your bot can initiate escalation by inviting others, provided your bot has the initiate-group-call permission.</span></span> <span data-ttu-id="74aaa-125">如果升级启动另一个参与者，并且 bot 没有加入组呼叫权限，则从调用丢弃您自动程序。</span><span class="sxs-lookup"><span data-stu-id="74aaa-125">If escalation is initiated by another participant and the bot does not have join-group-call permission, your bot is dropped from the call.</span></span>

> <span data-ttu-id="74aaa-126">**重要：** 当从对等情况下，呼叫上报给多方时，并非所有的多方功能均可用。</span><span class="sxs-lookup"><span data-stu-id="74aaa-126">**Important:** When a call is escalated from peer-to-peer to multiparty, not all multiparty features are available.</span></span> <span data-ttu-id="74aaa-127">具体而言，自动程序不会收到名单更新。</span><span class="sxs-lookup"><span data-stu-id="74aaa-127">Specifically, the bot will not receive roster updates.</span></span>

## <a name="signaling"></a><span data-ttu-id="74aaa-128">信号</span><span class="sxs-lookup"><span data-stu-id="74aaa-128">Signaling</span></span>

### <a name="incoming-call"></a><span data-ttu-id="74aaa-129">传入呼叫</span><span class="sxs-lookup"><span data-stu-id="74aaa-129">Incoming call</span></span>

<span data-ttu-id="74aaa-130">若要接收传入呼叫，您需要注册调用 bot。</span><span class="sxs-lookup"><span data-stu-id="74aaa-130">To receive an incoming call, you need to register the calling bot.</span></span> <span data-ttu-id="74aaa-131">Bot 接收传入通知时，它具有以下选项。</span><span class="sxs-lookup"><span data-stu-id="74aaa-131">When the bot receives the incoming notification, it has the following options.</span></span>

| <span data-ttu-id="74aaa-132">方法</span><span class="sxs-lookup"><span data-stu-id="74aaa-132">Method</span></span>                              | <span data-ttu-id="74aaa-133">说明</span><span class="sxs-lookup"><span data-stu-id="74aaa-133">Description</span></span>                                  |
|:------------------------------------|:---------------------------------------------|
| [<span data-ttu-id="74aaa-134">答案</span><span class="sxs-lookup"><span data-stu-id="74aaa-134">Answer</span></span>](../api/call-answer.md)     | <span data-ttu-id="74aaa-135">应答传入呼叫。</span><span class="sxs-lookup"><span data-stu-id="74aaa-135">Answer the incoming call.</span></span>                    |
| [<span data-ttu-id="74aaa-136">Reject</span><span class="sxs-lookup"><span data-stu-id="74aaa-136">Reject</span></span>](../api/call-reject.md)     | <span data-ttu-id="74aaa-137">拒绝和挂断呼叫。</span><span class="sxs-lookup"><span data-stu-id="74aaa-137">Reject and hangup the call.</span></span>                  |
| [<span data-ttu-id="74aaa-138">重定向</span><span class="sxs-lookup"><span data-stu-id="74aaa-138">Redirect</span></span>](../api/call-redirect.md) | <span data-ttu-id="74aaa-139">将呼叫重定向。</span><span class="sxs-lookup"><span data-stu-id="74aaa-139">Redirect the call.</span></span>                           |

<span data-ttu-id="74aaa-140">Bot 可以呼叫重定向到另一个用户或自动程序。</span><span class="sxs-lookup"><span data-stu-id="74aaa-140">The bot can redirect the call to another user or a bot.</span></span> <span data-ttu-id="74aaa-141">Bot 可以还将其重定向到用户的语音邮件。</span><span class="sxs-lookup"><span data-stu-id="74aaa-141">The bot can also redirect it to a user's voicemail.</span></span>

![显示自动程序重定向至语音邮件的呼叫的图像](https://cdn.graph.office.net/prod/GraphDocuments/en-us/concepts/images/call-handling.png)

> <span data-ttu-id="74aaa-143">**重要：** 重定向或发起出站 pstn 呼叫当前不支持。</span><span class="sxs-lookup"><span data-stu-id="74aaa-143">**Important:** Redirecting or making outbound calls to PSTN is currently not supported.</span></span>

### <a name="in-call"></a><span data-ttu-id="74aaa-144">呼叫中</span><span class="sxs-lookup"><span data-stu-id="74aaa-144">In-call</span></span>

<span data-ttu-id="74aaa-145">自动程序的操作是调用对象上可用。</span><span class="sxs-lookup"><span data-stu-id="74aaa-145">Operations for the bot are available on the call object.</span></span> <span data-ttu-id="74aaa-146">这些呼叫中的参与者作为影响 bot。</span><span class="sxs-lookup"><span data-stu-id="74aaa-146">These affect the bot as the participant in the call.</span></span>

| <span data-ttu-id="74aaa-147">方法</span><span class="sxs-lookup"><span data-stu-id="74aaa-147">Method</span></span>                                                            | <span data-ttu-id="74aaa-148">说明</span><span class="sxs-lookup"><span data-stu-id="74aaa-148">Description</span></span>                                  |
|:------------------------------------------------------------------|:---------------------------------------------|
| [<span data-ttu-id="74aaa-149">设置为静音</span><span class="sxs-lookup"><span data-stu-id="74aaa-149">Mute</span></span>](../api/call-mute.md)                                       | <span data-ttu-id="74aaa-150">在呼叫中的静音自我。</span><span class="sxs-lookup"><span data-stu-id="74aaa-150">Mute self in the call.</span></span>                       |
| [<span data-ttu-id="74aaa-151">取消静音</span><span class="sxs-lookup"><span data-stu-id="74aaa-151">Unmute</span></span>](../api/call-unmute.md)                                   | <span data-ttu-id="74aaa-152">在呼叫中的取消静音自我。</span><span class="sxs-lookup"><span data-stu-id="74aaa-152">Unmute self in the call.</span></span>                     |
| [<span data-ttu-id="74aaa-153">UpdateMetadata</span><span class="sxs-lookup"><span data-stu-id="74aaa-153">UpdateMetadata</span></span>](../api/call-updatemetadata.md)                   | <span data-ttu-id="74aaa-154">在名单中的自助更新元数据。</span><span class="sxs-lookup"><span data-stu-id="74aaa-154">Update metadata for self in roster.</span></span>          |
| [<span data-ttu-id="74aaa-155">ChangeScreenSharingRole</span><span class="sxs-lookup"><span data-stu-id="74aaa-155">ChangeScreenSharingRole</span></span>](../api/call-changescreensharingrole.md) | <span data-ttu-id="74aaa-156">启动和停止共享的调用中的屏幕。</span><span class="sxs-lookup"><span data-stu-id="74aaa-156">Start and stop sharing screen in the call.</span></span>   |

<span data-ttu-id="74aaa-157">要与其他参与者的呼叫进行交互，使用参与者对象。</span><span class="sxs-lookup"><span data-stu-id="74aaa-157">To interact with other participants on the call, use the participants object.</span></span>

| <span data-ttu-id="74aaa-158">方法</span><span class="sxs-lookup"><span data-stu-id="74aaa-158">Method</span></span>                                                            | <span data-ttu-id="74aaa-159">说明</span><span class="sxs-lookup"><span data-stu-id="74aaa-159">Description</span></span>                                  |
|:------------------------------------------------------------------|:---------------------------------------------|
| [<span data-ttu-id="74aaa-160">参与者列表</span><span class="sxs-lookup"><span data-stu-id="74aaa-160">List participants</span></span>](../api/call-list-participants.md)             | <span data-ttu-id="74aaa-161">获取参与者对象集合。</span><span class="sxs-lookup"><span data-stu-id="74aaa-161">Get a participant object collection.</span></span>         |
| [<span data-ttu-id="74aaa-162">邀请参与者</span><span class="sxs-lookup"><span data-stu-id="74aaa-162">Invite Participants</span></span>](../api/participant-invite.md)               | <span data-ttu-id="74aaa-163">邀请参与者加入活动呼叫。</span><span class="sxs-lookup"><span data-stu-id="74aaa-163">Invite participants to the active call.</span></span>      |
| [<span data-ttu-id="74aaa-164">将所有参与者设为都静音</span><span class="sxs-lookup"><span data-stu-id="74aaa-164">Mute All Participants</span></span>](../api/participant-muteall.md)            | <span data-ttu-id="74aaa-165">将呼叫中的所有参与者设为都静音。</span><span class="sxs-lookup"><span data-stu-id="74aaa-165">Mute all participants in the call.</span></span>           |

## <a name="media"></a><span data-ttu-id="74aaa-166">媒体</span><span class="sxs-lookup"><span data-stu-id="74aaa-166">Media</span></span>

<span data-ttu-id="74aaa-167">通过 Microsoft 实时媒体平台管理媒体处理。</span><span class="sxs-lookup"><span data-stu-id="74aaa-167">Media processing is managed through the Microsoft Real-time Media Platform.</span></span> <span data-ttu-id="74aaa-168">实时媒体平台帮助 bot 参与 Microsoft 团队音频/视频呼叫和会议。</span><span class="sxs-lookup"><span data-stu-id="74aaa-168">The Real-time Media Platform helps bots engage in Microsoft Teams audio/video calls and meetings.</span></span> <span data-ttu-id="74aaa-169">它允许实时 bot 参加对等和多方呼叫。</span><span class="sxs-lookup"><span data-stu-id="74aaa-169">It allows real-time bots to participate in both peer-to-peer and multiparty calls.</span></span>

<span data-ttu-id="74aaa-170">当 bot 应答传入呼叫，或加入新的或现有的呼叫时，则需要告知实时媒体平台将如何处理媒体。</span><span class="sxs-lookup"><span data-stu-id="74aaa-170">When the bot answers an incoming call, or joins a new or existing call, it needs to tell the Real-time Media Platform how media will be handled.</span></span> <span data-ttu-id="74aaa-171">如果您要构建互动语音响应 (IVR) 系统，您可以卸载昂贵音频处理 Microsoft 承载的服务媒体组件。</span><span class="sxs-lookup"><span data-stu-id="74aaa-171">If you are building an Interactive Voice Response (IVR) system, you can offload the expensive audio processing to Microsoft service hosted media components.</span></span> <span data-ttu-id="74aaa-172">如果您自动程序需要直接访问媒体流，我们可以提供通过实时媒体 SDK 的应用程序托管媒体选项。</span><span class="sxs-lookup"><span data-stu-id="74aaa-172">If your bot requires direct access to media streams, we offer an application-hosted media option through the Real-time Media SDK.</span></span>

### <a name="service-hosted-media"></a><span data-ttu-id="74aaa-173">服务承载媒体</span><span class="sxs-lookup"><span data-stu-id="74aaa-173">Service-hosted media</span></span>

<span data-ttu-id="74aaa-174">自动程序可以管理工作流和卸载到 Microsoft 实时媒体平台的音频处理。</span><span class="sxs-lookup"><span data-stu-id="74aaa-174">Bots can manage the workflow and offload audio processing to the Microsoft Real-time Media Platform.</span></span> <span data-ttu-id="74aaa-175">使用服务承载媒体，您必须实现和承载您 bot 多种选项。</span><span class="sxs-lookup"><span data-stu-id="74aaa-175">With service-hosted media, you have serveral options to implement and host your bot.</span></span> <span data-ttu-id="74aaa-176">请考虑使用一个可用的[Sdk](https://developer.microsoft.com/graph/code-samples-and-sdks)。</span><span class="sxs-lookup"><span data-stu-id="74aaa-176">Consider using one of the available [SDKs](https://developer.microsoft.com/graph/code-samples-and-sdks).</span></span> <span data-ttu-id="74aaa-177">服务承载媒体自动程序可以实现作为无状态服务，如它不处理媒体本地。</span><span class="sxs-lookup"><span data-stu-id="74aaa-177">A service-hosted media bot can be implemented as a stateless service as it does not process media locally.</span></span>

| <span data-ttu-id="74aaa-178">方法</span><span class="sxs-lookup"><span data-stu-id="74aaa-178">Method</span></span>                                                        | <span data-ttu-id="74aaa-179">说明</span><span class="sxs-lookup"><span data-stu-id="74aaa-179">Description</span></span>                                             |
|:--------------------------------------------------------------|:--------------------------------------------------------|
| [<span data-ttu-id="74aaa-180">PlayPrompt</span><span class="sxs-lookup"><span data-stu-id="74aaa-180">PlayPrompt</span></span>](../api/call-playprompt.md)                       | <span data-ttu-id="74aaa-181">向用户播放音频剪辑。</span><span class="sxs-lookup"><span data-stu-id="74aaa-181">Play an audio clip to the user.</span></span>                         |
| [<span data-ttu-id="74aaa-182">Record</span><span class="sxs-lookup"><span data-stu-id="74aaa-182">Record</span></span>](../api/call-record.md)                               | <span data-ttu-id="74aaa-183">（可选） 播放提示和录制音频剪辑。</span><span class="sxs-lookup"><span data-stu-id="74aaa-183">Optionally play a prompt and record an audio clip.</span></span>      |
| [<span data-ttu-id="74aaa-184">SubscribeToTone</span><span class="sxs-lookup"><span data-stu-id="74aaa-184">SubscribeToTone</span></span>](../api/call-subscribetotone.md)             | <span data-ttu-id="74aaa-185">从用户订阅 DTMF 声音信号。</span><span class="sxs-lookup"><span data-stu-id="74aaa-185">Subscribe to DTMF tones from the user.</span></span>                  |
| [<span data-ttu-id="74aaa-186">CancelMediaProcessing</span><span class="sxs-lookup"><span data-stu-id="74aaa-186">CancelMediaProcessing</span></span>](../api/call-cancelmediaprocessing.md) | <span data-ttu-id="74aaa-187">取消任何处理已排队的媒体。</span><span class="sxs-lookup"><span data-stu-id="74aaa-187">Cancel any media processing already queued.</span></span>             |

### <a name="application-hosted-media"></a><span data-ttu-id="74aaa-188">应用程序托管媒体</span><span class="sxs-lookup"><span data-stu-id="74aaa-188">Application-hosted media</span></span>

<span data-ttu-id="74aaa-189">若要获取直接访问媒体 bot、 bot 需要访问媒体权限。</span><span class="sxs-lookup"><span data-stu-id="74aaa-189">For the bot to get direct access to the media, the bot needs the Access-Media permission.</span></span> <span data-ttu-id="74aaa-190">实时媒体库和状态 SDK 帮助您生成调用 bot 富实时媒体。</span><span class="sxs-lookup"><span data-stu-id="74aaa-190">The Real-time Media library and the stateful SDK helps you build rich real-time media calling bots.</span></span> <span data-ttu-id="74aaa-191">必须在 Windows 环境中承载应用程序托管的自动程序。</span><span class="sxs-lookup"><span data-stu-id="74aaa-191">An application-hosted bot must be hosted in a Windows environment.</span></span> <span data-ttu-id="74aaa-192">[应用程序托管的媒体示例](https://github.com/microsoftgraph/microsoft-graph-comms-samples)说明如何生成 bot （包括云服务和服务结构） 的各种 Azure 平台中。</span><span class="sxs-lookup"><span data-stu-id="74aaa-192">[Application hosted media samples](https://github.com/microsoftgraph/microsoft-graph-comms-samples) show how to build the bot in various Azure Platforms (including Cloud Services and Service Fabric).</span></span>

<span data-ttu-id="74aaa-193">您可以使用[Microsoft Graph 呼叫 SDK](https://microsoftgraph.github.io/microsoft-graph-comms-samples/docs/articles/index.html)简化创建自动程序。</span><span class="sxs-lookup"><span data-stu-id="74aaa-193">You can use the [Microsoft Graph Calls SDK](https://microsoftgraph.github.io/microsoft-graph-comms-samples/docs/articles/index.html) to simplify the creation of bots.</span></span> <span data-ttu-id="74aaa-194">SDK 提供功能来管理在内存中的资源的状态并提取自动程序开发人员的媒体堆栈中。</span><span class="sxs-lookup"><span data-stu-id="74aaa-194">The SDK provides functionality to manage the states of the resources in memory and to pull in bot developers' media stack.</span></span>

<span data-ttu-id="74aaa-195">媒体 SDK 允许 bot 发送和接收音频、 视频和基于视频的屏幕共享内容。</span><span class="sxs-lookup"><span data-stu-id="74aaa-195">The Media SDK allows the bot to send and receive audio, video, and video-based screen sharing content.</span></span> <span data-ttu-id="74aaa-196">基于视频的屏幕共享为视频信道建模。</span><span class="sxs-lookup"><span data-stu-id="74aaa-196">Video-based screen sharing is modeled as a video channel.</span></span> <span data-ttu-id="74aaa-197">Bot 可以订阅混合音频频道服务器和多个视频信道。</span><span class="sxs-lookup"><span data-stu-id="74aaa-197">The bot can subscribe to the mixed audio channel and multiple video channels.</span></span> <span data-ttu-id="74aaa-198">对于视频的通道，bot 已发送和接收视频编码的 H.264 流作为或已解码的原始框架可选择。</span><span class="sxs-lookup"><span data-stu-id="74aaa-198">For the video channel, the bot has a choice to send and receive video as an encoded H.264 stream or as decoded raw frames.</span></span>

> <span data-ttu-id="74aaa-199">**注意：** 您不可能使用 Microsoft.Graph.Calls.Media API 记录或否则保持从呼叫或您自动程序访问的会议的媒体内容。</span><span class="sxs-lookup"><span data-stu-id="74aaa-199">**Note:** You may not use the Microsoft.Graph.Calls.Media API to record or otherwise persist media content from calls or meetings that your bot accesses.</span></span>

## <a name="see-also"></a><span data-ttu-id="74aaa-200">另请参阅</span><span class="sxs-lookup"><span data-stu-id="74aaa-200">See also</span></span>

[<span data-ttu-id="74aaa-201">呼叫和联机会议 API 示例</span><span class="sxs-lookup"><span data-stu-id="74aaa-201">Calls and online meetings API samples</span></span>](https://github.com/microsoftgraph/microsoft-graph-comms-samples/)

[<span data-ttu-id="74aaa-202">已知问题</span><span class="sxs-lookup"><span data-stu-id="74aaa-202">Known issues</span></span>](/graph/known-issues#calls-and-online-meetings)
